---
title: "Revisting NHL Salary Prediction with XGBoost"
date: 2019-05-18
tags: [Machine Learning, R]
excerpt: "Improving NHL Salary Predictions with the popular XGBoost algorithm"
---

## Objective:

In the previous post in this series, I attempted to predict NHL player salaries based on player characteristics and performance measures from the 2016-2017 NHL season. If you haven't already read that post, you should check it out [here](https://viktorseregelyi.github.io/hockey/) first.

Some of the models we tried gave us decent predictions, but I know we can do better. I think it's time to bring out the big guns with the XGBoost (eXtreme Gradient Boosting) algorithm. XGBoost is currently one of the most popular algorithms in Kaggle competitions, and for good reason. It's a scalable tree boosting system that performs extremely well in both classification and regression problems. Now without futher ado, let's get started.

## Analysis:

We'll use the same dataset and variables that we did in our first attempts at predicting NHL salaries.

```r
library(caret)
library(xgboost)
library(data.table)

setwd("C:\\Users\\Viktor\\Desktop")
dat = read.csv("NHL_2016-17_Cleaned_v2.csv", header = T)
dat = na.omit(dat)

set.seed(42)
#Create subset of dataset using features from the last post
new_dat = dat[,c(152, 1, 24, 14, 36, 38, 17, 60, 12, 42)]
summary(new_dat)

holdout_idx = createDataPartition(new_dat$Salary, p = 0.9, list = FALSE)
modeldat = new_dat[holdout_idx, ]
holdout = new_dat[-holdout_idx, ]


idx = createDataPartition(modeldat$Salary, p = 0.8, list = FALSE)
dat_trn = modeldat[idx, ]
dat_tst = modeldat[-idx, ]
```
The only difference is this time, we'll have a training set, a test set for tuning parameters (model validation) and a final holdout set not used to train or tune the model at all for the end test results (no cheating!).

Now we're ready to prepare our data and preprocess for XGboost. 
```r
setDT(dat_trn)
setDT(dat_tst)

labels <- dat_trn$Salary
ts_label <- dat_tst$Salary
new_tr <- model.matrix(~.+0,data = dat_trn[,-c("Salary"),with=F])
new_ts <- model.matrix(~.+0,data = dat_tst[,-c("Salary"),with=F])
labels <- as.numeric(labels)
ts_label <- as.numeric(ts_label)

xgb_train <- xgb.DMatrix(data = new_tr,label = labels) 
xgb_test <- xgb.DMatrix(data = new_ts,label=ts_label)

```
